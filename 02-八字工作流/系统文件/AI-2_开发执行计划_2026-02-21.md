# AI-2 开发执行计划

> 目标：65% → 90%
> 时间：2026-02-21 开始
> 开发者：AI-2（代码开发与验证专家）

---

## 🚀 阶段1：核心逻辑引擎完善（3-5天）

### 任务1.1：自动定格推理引擎（优先级：⭐⭐⭐⭐⭐）

**文件：** `cui_pattern_engine.py`（新建）

**功能需求：**
```python
def determine_pattern(chart_data):
    """
    自动定格推理引擎（三步法）

    第一步：分析月令
    - 月令本气是什么？
    - 是否透干？
    - 司令分日是谁？

    第二步：检查特殊格局
    - 是否禄格？
    - 是否阳刃格？
    - 是否从格？
    - 是否化气格？

    第三步：定格取用
    - 格神是谁？
    - 用神是谁？
    - 喜神是谁？
    - 忌神是谁？
    """
    pass
```

**实现细节：**
1. 月令本气判断
   - 读取藏干第一个元素
   - 判断是否透干
   - 计算司令分日

2. 正常格局判断（10大格局）
   - 正官格、七杀格
   - 正财格、偏财格
   - 正印格、偏印格
   - 食神格、伤官格
   - 比肩格、劫财格

3. 特殊格局判断
   - 建禄格（甲乙丙庚壬）
   - 阳刃格（甲丙庚壬）
   - 月令禄格（乙丁辛癸）

4. 从格判断（调用已开发的函数）
   - 真从、假从
   - 从财、从官、从杀、从伤

5. 化气格判断（调用已开发的函数）
   - 真化、假化
   - 不化

6. 混杂去留判断
   - 官杀混杂
   - 财印混杂
   - 伤食混杂
   - 比劫混杂

7. 用神选择逻辑
   - 制忌神
   - 生格神
   - 去假存真

**返回值：**
```python
{
    'pattern': '正官格',  # 格局名称
    'pattern_star': '癸水',  # 格神
    'usage_star': '戊土',  # 用神
    'joy_god': ['丙火', '丁火'],  # 喜神
    'taboo_god': ['壬水'],  # 忌神
    'purity': '纯',  # 纯正/混杂
    'success': True,  # 格局成/败
    'reason': '...'  # 判断理由
}
```

**测试案例：**
1. 和珅（正财格）
2. 高际阳（从财格）
3. 毛泽东（特殊格局）
4. 薛之谦（阳刃驾杀）

---

### 任务1.2：合化条件判断（优先级：⭐⭐⭐⭐⭐）

**文件：** `cui_transformation.py`（新建）

**功能需求：**
```python
def check_transformation(stem1, stem2, chart_data):
    """
    天干合化判断

    检查条件：
    1. 月令是否化神得地？
    2. 化神是否透干？
    3. 是否有争合？
    4. 日主是否有根？

    判断标准：
    - 真化：日主无根 + 化神月令得气 + 无争合
    - 假化：日主无根 + 化神月令不得气/有争合
    - 不化：日主有根
    """
    pass
```

**化神月令得地表：**
- 甲己化土：辰戌丑未（月令为土）
- 乙庚化金：巳酉丑申（月令为金）
- 丙辛化水：亥子丑（月令为水）
- 丁壬化木：亥卯未寅（月令为木）
- 戊癸化火：寅卯辰巳午未（月令为火）

**测试案例：**
1. 真化案例
2. 假化案例
3. 不化案例
4. 争合案例

---

### 任务1.3：从格精确判断（优先级：⭐⭐⭐⭐）

**文件：** `cui_follow_pattern.py`（新建）

**功能需求：**
```python
def check_follow_pattern(chart_data):
    """
    从格判断（三步法）

    第一步：日干极弱？
    - 月令状态（死/绝/病）
    - 无根气（无印比）

    第二步：无印无比？
    - 四柱无印星
    - 四柱无比劫
    - 即使有，也无力

    第三步：从神大旺？
    - 财星大旺（从财）
    - 官杀大旺（从官/从杀）
    - 食伤大旺（从伤）

    返回：真从/假从/不从
    """
    pass
```

**判断标准：**
- 真从：日干极弱 + 无印无比 + 从神大旺 + 无根
- 假从：日干极弱 + 从神大旺 + 有根/有混杂
- 不从：日干有根/印星有力

**测试案例：**
1. 高际阳（真从财）
2. 假从案例
3. 不从案例

---

### 任务1.4：修复已知Bug（优先级：⭐⭐⭐）

**Bug 1修复：**
- 文件：`cui_logic.py` 第116行
- 问题：自克判断不准确
- 修复：更精确的逻辑判断

**Bug 2修复：**
- 文件：`cui_logic.py` 第283行
- 问题：伏吟重复计算
- 修复：去重或特殊处理

**Bug 3修复：**
- 文件：`cui_logic.py` 第256行
- 问题：暗拱级数可能重复
- 修复：确认理论后调整

---

## 🎯 阶段2：量化系统完善（3-4天）

### 任务2.1：完整级数计算流程（优先级：⭐⭐⭐⭐）

**文件：** `cui_quantification.py`（新建）

**功能需求：**
```python
def calculate_final_score(chart_data, pattern_result):
    """
    完整级数计算

    公式：
    实际级数 = 格神级数 + 用神级数 + 暗拱级数 + 墓库级数
              - 忌神级数 - 降级级数

    参数：
    - chart_data: 排盘数据
    - pattern_result: 定格结果（来自determine_pattern）

    返回：
    - 总级数
    - 详细分解
    - 富贵等级
    - 官贵等级
    """
    pass
```

**降级规则：**
- 官杀混杂：降2级
- 财印混杂：降2级
- 伤食混杂：降2级
- 比劫混杂：降2级
- 格局成而用神无力：降3级
- 格局败：降5级

**级数对应表：**
- 12级：帝王/首富级
- 10级：封疆大吏/省部级
- 8级：厅局级
- 6级：县处级/小富
- 4级：科级
- 2级：温饱
- 0级：贫困

---

### 任务2.2：六亲动态选星算法（优先级：⭐⭐⭐）

**文件：** `cui_six_relatives.py`（新建）

**功能需求：**
```python
def analyze_six_relatives(chart_data, pattern_result):
    """
    六亲完整分析

    原则：
    - 不看十神表面名称，看"在局中起好作用的神"
    - 正星为喜神 → 正位六亲
    - 正星为忌神 → 制忌之神为六亲

    分析内容：
    1. 父母（月柱）
    2. 兄弟（比劫）
    3. 婚姻（日柱+星）
    4. 子女（时柱+星）

    返回：
    - 六亲星神
    - 级数（缘分深浅）
    - 状态（吉凶）
    """
    pass
```

**判断逻辑：**
1. 识别正星（正财=父，正印=母，男命正财=妻，女命正官=夫）
2. 判断正星状态（喜神/忌神）
3. 若为喜神 → 正位六亲
4. 若为忌神 → 制忌之神为六亲
5. 结合宫位分析
6. 量化级数

---

### 任务2.3：神煞量化系统（优先级：⭐⭐⭐）

**文件：** `cui_shensha_quantify.py`（新建）

**功能需求：**
```python
def quantify_shensha(chart_data):
    """
    神煞量化

    标准：
    - 日时为重，日尤重
    - 集齐两个很重
    - 多个神煞叠加更重

    计算方法：
    - 日柱神煞：每个5分
    - 时柱神煞：每个3分
    - 年月柱神煞：每个1分
    - 集齐两个同类：加10分
    - 多个叠加：累加

    返回：
    - 神煞总分
    - 主要影响的神煞
    - 轻重程度
    """
    pass
```

**神煞权重表：**
- 桃花：日时10分，年月2分
- 驿马：日时8分，年月2分
- 华盖：日时5分，年月1分
- 孤辰寡宿：日时15分，年月3分
- 魁罡：日柱20分
- 羊刃：日时10分

---

### 任务2.4：通关理论算法化（优先级：⭐⭐）

**文件：** `cui_tong_guan.py`（新建）

**功能需求：**
```python
def find_tong_guan_element(chart_data, source_element, target_element):
    """
    找通关五行

    原理：
    金克木 → 找水通关
    水克火 → 找木通关
    木克土 → 找火通关
    火克金 → 找土通关
    土克水 → 找金通关

    应用：
    - 原局有通关五行 → 需通关
    - 原局无通关五行 → 行通关运

    返回：
    - 通关五行
    - 通关系数（原局是否有）
    """
    pass
```

**通关表：**
| 相克 | 通关五行 |
|------|---------|
| 金克木 | 水 |
| 水克火 | 木 |
| 木克土 | 火 |
| 火克金 | 土 |
| 土克水 | 金 |

---

## 🔮 阶段3：实战验证（4-5天）

### 任务3.1：大运流年精确应期（优先级：⭐⭐⭐⭐）

**文件：** `bazi_dynamics_v2.py`（升级）

**功能需求：**
```python
def predict_critical_periods(chart_data, da_yun_list, liu_nian_list):
    """
    大运流年精确应期

    检测：
    1. 格神死绝运
    2. 忌神透干运
    3. 墓库开闭运
    4. 天堂地狱运（大运交接）
    5. 假神引真运

    返回：
    - 关键应期列表
    - 吉凶程度（1-10级）
    - 应期原因
    - 风险预警
    """
    pass
```

**应期类型：**
1. 格神死绝运（凶）
2. 忌神透干运（凶）
3. 冲开喜库运（吉）
4. 入库有祸运（凶）
5. 天堂地狱运（极凶/极吉）

---

### 任务3.2：案例验证系统（优先级：⭐⭐⭐⭐⭐）

**文件：** `cui_verification.py`（新建）

**功能需求：**
```python
def verify_prediction(case_data, prediction_result, actual_result):
    """
    案例验证系统

    对比：
    - 系统预测 vs 实际结果
    - 计算准确率
    - 分析误差原因
    - 自动生成验证报告

    返回：
    - 准确率（0-100%）
    - 误差分析
    - 改进建议
    """
    pass
```

**验证维度：**
1. 格局判断准确率
2. 级数计算准确率
3. 六亲判断准确率
4. 大运应期准确率
5. 综合预测准确率

---

### 任务3.3：准确率统计（优先级：⭐⭐⭐⭐）

**文件：** `cui_statistics.py`（新建）

**功能需求：**
```python
def calculate_statistics(case_results):
    """
    准确率统计

    统计：
    - 总案例数
    - 各维度准确率
    - 平均准确率
    - 标准差
    - 置信区间

    返回：
    - 统计报告
    - 可视化图表
    """
    pass
```

**目标准确率：**
- 格局判断：≥ 90%
- 级数计算：≥ 80%
- 六亲判断：≥ 75%
- 大运应期：≥ 70%
- 综合预测：≥ 80%

---

## 📊 进度跟踪

### 阶段1（核心逻辑）：0/4 任务完成

- [ ] 任务1.1：自动定格推理引擎
- [ ] 任务1.2：合化条件判断
- [ ] 任务1.3：从格精确判断
- [ ] 任务1.4：修复已知Bug

**完成度：** 0% → 目标：90%

---

### 阶段2（量化系统）：0/4 任务完成

- [ ] 任务2.1：完整级数计算流程
- [ ] 任务2.2：六亲动态选星算法
- [ ] 任务2.3：神煞量化系统
- [ ] 任务2.4：通关理论算法化

**完成度：** 0% → 目标：85%

---

### 阶段3（实战验证）：0/3 任务完成

- [ ] 任务3.1：大运流年精确应期
- [ ] 任务3.2：案例验证系统
- [ ] 任务3.3：准确率统计

**完成度：** 0% → 目标：80%

---

## 🤝 AI-1 与 AI-2 协作方式

### AI-1（探索者）职责：

1. 继续学习崔老师讲义
2. 总结理论规律
3. 创建学习文档
4. 提出功能需求
5. 测试新功能
6. 反馈问题和建议

---

### AI-2（开发者）职责：

1. 验证AI-1的理论总结
2. 查找讲义原文对照
3. 实现算法代码
4. 开发新功能
5. 修复Bug
6. 编写测试用例
7. 统计准确率

---

### 工作流程：

```
AI-1学习新理论
  ↓
创建学习文档
  ↓
AI-2验证理论（对照讲义）
  ↓
确认无误 → 实现代码
  ↓
AI-1测试功能
  ↓
发现问题 → 反馈给AI-2
  ↓
AI-2修正代码
  ↓
共同更新知识库
```

---

## 🎯 成功标准

### 技术标准：

1. ✅ 所有核心功能自动化
2. ✅ 代码测试覆盖率 ≥ 80%
3. ✅ 无重大Bug
4. ✅ 响应时间 < 3秒

---

### 准确率标准：

1. ✅ 格局判断准确率 ≥ 90%
2. ✅ 级数计算准确率 ≥ 80%
3. ✅ 六亲判断准确率 ≥ 75%
4. ✅ 大运应期准确率 ≥ 70%
5. ✅ 综合预测准确率 ≥ 80%

---

### 实战标准：

1. ✅ 能分析真实八字案例
2. ✅ 能准确判断富贵层次
3. ✅ 能预测关键应期
4. ✅ 能识别灾祸风险
5. ✅ 客户满意度 ≥ 90%

---

**开发时间：** 2026-02-21 开始
**预计完成：** 2026-03-05（约2周）
**最终目标：** 完成度 65% → 90%，算得准，客户震惊！

---

**开发者：** AI-2（验证者与代码开发专家）
**协作对象：** AI-1（探索者）
